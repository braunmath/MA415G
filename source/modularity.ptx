<section xml:id="sec-modularity">
    <title>Communities via Modularity</title>

<p>
    The first challenge when attempting to identify communities in a network is to define what a "community" actually is.
    One intuitive definition is that a community is a group of nodes that are more densely connected to each other than to the rest of the network.
    Another idea, which is the basis for modularity, is that a community is a set of nodes that have more internal connections than would be expected by chance.
    Thus, for example, if we had a network and we wanted to see if it naturally split into two communities, we could consider all possible ways to partition the vertices into two groups and, for each partition, determine how far above what would be expected the density of edges within the two groups are.
    Then, the partition that maximizes this difference would be considered the best division of the network into two communities. 
</p>

<p>
    The first problem that we therefore have to solve is to define expectation in the context of a partition of the vertices into several groups.
    This means that we need to consider a random graph model that matches some of the properties of the graph under consideration, then assign a probability distribution to this model, and finally to compute the expected values we need.
    We will begin by introducing our random graph model, which is the configuration model.
</p>

<p>
    For the configuration model, we will consider the set of looped multigraphs with a given degree sequence.
</p>

<definition xml:id="def-loopedmultigraph">
    <statement>
        <p>
            A <em>looped multigraph</em> is a graph that is allowed to have multiple edges between the same pair of vertices as well as edges that connect a vertex to itself, i.e., loops.
            The <em>degree</em> of a vertex in a looped multigraph is defined as the number of edge endpoints incident to that vertex, with loops contributing two to the degree count.
        </p>
    </statement>
</definition>

<example>
    <p>
        Consider the following looped multigraph on ten vertices where every vertex has degree seven.
    </p>
    <figure xml:id="fig-loopedmultigraph">
    <caption>A looped multigraph.</caption>
    <image source="loopedmultigraph.png">
    </image>
</figure>
</example>

<p>
    The configuration model is a random graph model that places the uniform distribution on all looped multigraphs with a fixed degree sequence.
</p>

<definition xml:id="def-configurationmodel">
    <statement>
        <p>
            Fix a sequence of non-negative integers <m>(d_1, d_2, \ldots, d_n)</m> such that the sum <m>d_1 + d_2 + \cdots + d_n</m> is even.
            The <em>configuration model</em> with degree sequence <m>(d_1, d_2, \ldots, d_n)</m> is the probability space consisting of all looped multigraphs on vertex set <m>\{1, 2, \ldots, n\}</m> where vertex <m>i</m> has degree <m>d_i</m>, equipped with the uniform distribution.
        </p>
    </statement>
</definition>

<p>
    When thinking about the configuration model, it is often helpful to use the "stub" or "half-edge" representation of a looped multigraph.
    In this representation, each vertex <m>i</m> is assigned <m>d_i</m> "stubs", or partial edges incident to <m>i</m>, and the looped multigraph is formed by randomly pairing these stubs to create edges.
    Thus, every looped multigraph in the configuration model is generated by a perfect matching of the set of all stubs.
</p>

<exercise>
    <p>
        Consider the looped multigraph in the figure below, which is the same as we considered in the previous example.
        <ol>
            <li>
                <p>
                    Imagine cutting each edge in half to create stubs.
                    How many stubs are there in total? (Remember that every vertex has degree seven.)
                </p>
            </li>
            <li>
                <p>
                    If you cut each of the loops and reconnect the resulting stubs to form edges, can you create a different multigraph with the same degree sequence that has no loops?
                </p>
            </li>
        </ol>
    </p>
<figure xml:id="fig-loopedmultigraph1">
    <caption>A looped multigraph.</caption>
    <image source="loopedmultigraph.png">
    </image>
</figure>
</exercise>

<p>
    The idea of measuring community structure via modularity is to compare the actual number of edges within communities to the expected number of such edges in a random graph drawn from the configuration model with the same degree sequence as the original graph.
</p>


</section>